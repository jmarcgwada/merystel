/**
 * @file Firestore Security Rules
 * @description This ruleset is in PROTOTYPING mode. All reads and writes are currently allowed for all users.
 *              This is intended to provide the development team with maximum flexibility during the initial
 *              development phases. As the application matures, these rules MUST be updated to enforce
 *              a more restrictive security model.
 *
 * Core Philosophy:
 *   - The security model is temporarily OPEN, with all authenticated users able to read and write any data.
 *     This is NOT a secure configuration and MUST be changed before deployment to production.
 *
 * Data Structure:
 *   - Data is organized hierarchically, with company-specific data nested under /companies/{companyId}.
 *   - User profiles are stored under /users/{userId}.
 *
 * Key Security Decisions (Currently Relaxed):
 *   - All read and write access is allowed to all authenticated users.
 *   - No schema validation is enforced during this prototyping phase.
 *
 * WARNING: These rules are NOT suitable for production use.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Helper function to check if a user is signed in
    function isSignedIn() {
      return request.auth != null;
    }

    /**
     * @description Allows any signed-in user to read or write user profile data.
     * @path /users/{userId}
     * @allow (get, create, update, delete, list) - Any signed-in user
     * @deny (none) - There are no explicit deny rules in prototyping mode.
     * @principle Allows open access to user profiles for development purposes.
     */
    match /users/{userId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows any signed-in user to read or write company data.
     * @path /companies/{companyId}
     * @allow (get, create, update, delete, list) - Any signed-in user
     * @deny (none) - There are no explicit deny rules in prototyping mode.
     * @principle Allows open access to company data for development purposes.
     */
    match /companies/{companyId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if isSignedIn();

      /**
       * @description Allows any signed-in user to read or write customer data for a specific company.
       * @path /companies/{companyId}/customers/{customerId}
       * @allow (get, create, update, delete, list) - Any signed-in user
       * @deny (none) - There are no explicit deny rules in prototyping mode.
       * @principle Allows open access to customer data for development purposes.
       */
      match /customers/{customerId} {
        allow get, list: if isSignedIn();
        allow create, update, delete: if isSignedIn();
      }

      /**
       * @description Allows any signed-in user to read or write supplier data for a specific company.
       * @path /companies/{companyId}/suppliers/{supplierId}
       * @allow (get, create, update, delete, list) - Any signed-in user
       * @deny (none) - There are no explicit deny rules in prototyping mode.
       * @principle Allows open access to supplier data for development purposes.
       */
      match /suppliers/{supplierId} {
        allow get, list: if isSignedIn();
        allow create, update, delete: if isSignedIn();
      }

      /**
       * @description Allows any signed-in user to read or write category data for a specific company.
       * @path /companies/{companyId}/categories/{categoryId}
       * @allow (get, create, update, delete, list) - Any signed-in user
       * @deny (none) - There are no explicit deny rules in prototyping mode.
       * @principle Allows open access to category data for development purposes.
       */
      match /categories/{categoryId} {
        allow get, list: if isSignedIn();
        allow create, update, delete: if isSignedIn();
      }

      /**
       * @description Allows any signed-in user to read or write item data for a specific company.
       * @path /companies/{companyId}/items/{itemId}
       * @allow (get, create, update, delete, list) - Any signed-in user
       * @deny (none) - There are no explicit deny rules in prototyping mode.
       * @principle Allows open access to item data for development purposes.
       */
      match /items/{itemId} {
        allow get, list: if isSignedIn();
        allow create, update, delete: if isSignedIn();
      }

      /**
       * @description Allows any signed-in user to read or write table data for a specific company.
       * @path /companies/{companyId}/tables/{tableId}
       * @allow (get, create, update, delete, list) - Any signed-in user
       * @deny (none) - There are no explicit deny rules in prototyping mode.
       * @principle Allows open access to table data for development purposes.
       */
      match /tables/{tableId} {
        allow get, list: if isSignedIn();
        allow create, update, delete: if isSignedIn();
      }

      /**
       * @description Allows any signed-in user to read or write sale data for a specific company.
       * @path /companies/{companyId}/sales/{saleId}
       * @allow (get, create, update, delete, list) - Any signed-in user
       * @deny (none) - There are no explicit deny rules in prototyping mode.
       * @principle Allows open access to sale data for development purposes.
       */
      match /sales/{saleId} {
        allow get, list: if isSignedIn();
        allow create, update, delete: if isSignedIn();
      }

      /**
       * @description Allows any signed-in user to read or write payment method data for a specific company.
       * @path /companies/{companyId}/paymentMethods/{methodId}
       * @allow (get, create, update, delete, list) - Any signed-in user
       * @deny (none) - There are no explicit deny rules in prototyping mode.
       * @principle Allows open access to payment method data for development purposes.
       */
      match /paymentMethods/{methodId} {
        allow get, list: if isSignedIn();
        allow create, update, delete: if isSignedIn();
      }

      /**
       * @description Allows any signed-in user to read or write VAT rate data for a specific company.
       * @path /companies/{companyId}/vatRates/{vatId}
       * @allow (get, create, update, delete, list) - Any signed-in user
       * @deny (none) - There are no explicit deny rules in prototyping mode.
       * @principle Allows open access to VAT rate data for development purposes.
       */
      match /vatRates/{vatId} {
        allow get, list: if isSignedIn();
        allow create, update, delete: if isSignedIn();
      }

      /**
       * @description Allows any signed-in user to read or write held order data for a specific company.
       * @path /companies/{companyId}/heldOrders/{orderId}
       * @allow (get, create, update, delete, list) - Any signed-in user
       * @deny (none) - There are no explicit deny rules in prototyping mode.
       * @principle Allows open access to held order data for development purposes.
       */
      match /heldOrders/{orderId} {
        allow get, list: if isSignedIn();
        allow create, update, delete: if isSignedIn();
      }
    }
  }
}