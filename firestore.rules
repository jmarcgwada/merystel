rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Secure the /users collection, allowing only the owner to read/write their own profile.
     * @path /users/{userId}
     * @allow (get, create, update, delete) User 'gxU34URQdJd7VnovWOfAicXaJET2' can access their own profile.
     * @deny (get, create, update, delete) User 'anotherUser' cannot access User 'gxU34URQdJd7VnovWOfAicXaJET2' profile.
     * @principle Enforces document ownership for user profiles.
     */
    match /users/{userId} {
      function isOwner(userId) {
        return request.auth.uid == userId;
      }
      function isSignedIn() {
        return request.auth != null;
      }
      allow get: if isOwner(userId);
      allow list: if false;
      allow create: if isSignedIn() && isOwner(userId);
      allow update: if isSignedIn() && isOwner(userId);
      allow delete: if isSignedIn() && isOwner(userId);
    }

    /**
     * @description Secure the /companies collection, allowing authenticated users to read company information.
     * @path /companies/{companyId}
     * @allow (get, list) Any authenticated user can read company data.
     * @deny (create, update, delete) Only specific roles (e.g., admin) should be able to create, update, or delete company data (not yet implemented).
     * @principle Authenticated users can read company information.  Write access is restricted.
     */
    match /companies/{companyId} {
      function isSignedIn() {
        return request.auth != null;
      }
      allow get: if isSignedIn();
      allow list: if false;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Secure the /companies/{companyId}/customers collection, allowing authenticated users to read/write customer data within their company.
     * @path /companies/{companyId}/customers/{customerId}
     * @allow (get, list, create, update, delete) Any authenticated user can manage customers within their company.
     * @deny (get, list, create, update, delete)  Unauthenticated users cannot access customer data.
     * @principle Authenticated users can manage customer data within their company.
     */
    match /companies/{companyId}/customers/{customerId} {
      function isSignedIn() {
        return request.auth != null;
      }
      allow get: if isSignedIn();
      allow list: if false;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Secure the /companies/{companyId}/suppliers collection, allowing authenticated users to read/write supplier data within their company.
     * @path /companies/{companyId}/suppliers/{supplierId}
     * @allow (get, list, create, update, delete) Any authenticated user can manage suppliers within their company.
     * @deny (get, list, create, update, delete) Unauthenticated users cannot access supplier data.
     * @principle Authenticated users can manage supplier data within their company.
     */
    match /companies/{companyId}/suppliers/{supplierId} {
      function isSignedIn() {
        return request.auth != null;
      }
      allow get: if isSignedIn();
      allow list: if false;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Secure the /companies/{companyId}/categories collection, allowing authenticated users to read/write category data within their company.
     * @path /companies/{companyId}/categories/{categoryId}
     * @allow (get, list, create, update, delete) Any authenticated user can manage categories within their company.
     * @deny (get, list, create, update, delete) Unauthenticated users cannot access category data.
     * @principle Authenticated users can manage category data within their company.
     */
    match /companies/{companyId}/categories/{categoryId} {
      function isSignedIn() {
        return request.auth != null;
      }
      allow get: if isSignedIn();
      allow list: if false;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Secure the /companies/{companyId}/items collection, allowing authenticated users to read/write item data within their company.
     * @path /companies/{companyId}/items/{itemId}
     * @allow (get, list, create, update, delete) Any authenticated user can manage items within their company.
     * @deny (get, list, create, update, delete) Unauthenticated users cannot access item data.
     * @principle Authenticated users can manage item data within their company.
     */
    match /companies/{companyId}/items/{itemId} {
      function isSignedIn() {
        return request.auth != null;
      }
      allow get: if isSignedIn();
      allow list: if false;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Secure the /companies/{companyId}/tables collection, allowing authenticated users to read/write table data within their company.
     * @path /companies/{companyId}/tables/{tableId}
     * @allow (get, list, create, update, delete) Any authenticated user can manage tables within their company.
     * @deny (get, list, create, update, delete) Unauthenticated users cannot access table data.
     * @principle Authenticated users can manage table data within their company.
     */
    match /companies/{companyId}/tables/{tableId} {
      function isSignedIn() {
        return request.auth != null;
      }
      allow get: if isSignedIn();
      allow list: if false;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Secure the /companies/{companyId}/sales collection, allowing authenticated users to read/write sale data within their company.
     * @path /companies/{companyId}/sales/{saleId}
     * @allow (get, list, create, update, delete) Any authenticated user can manage sales within their company.
     * @deny (get, list, create, update, delete) Unauthenticated users cannot access sale data.
     * @principle Authenticated users can manage sale data within their company.
     */
    match /companies/{companyId}/sales/{saleId} {
      function isSignedIn() {
        return request.auth != null;
      }
      allow get: if isSignedIn();
      allow list: if false;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Secure the /companies/{companyId}/paymentMethods collection, allowing authenticated users to read/write payment method data within their company.
     * @path /companies/{companyId}/paymentMethods/{methodId}
     * @allow (get, list, create, update, delete) Any authenticated user can manage payment methods within their company.
     * @deny (get, list, create, update, delete) Unauthenticated users cannot access payment method data.
     * @principle Authenticated users can manage payment method data within their company.
     */
    match /companies/{companyId}/paymentMethods/{methodId} {
      function isSignedIn() {
        return request.auth != null;
      }
      allow get: if isSignedIn();
      allow list: if false;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Secure the /companies/{companyId}/vatRates collection, allowing authenticated users to read/write VAT rate data within their company.
     * @path /companies/{companyId}/vatRates/{vatId}
     * @allow (get, list, create, update, delete) Any authenticated user can manage VAT rates within their company.
     * @deny (get, list, create, update, delete) Unauthenticated users cannot access VAT rate data.
     * @principle Authenticated users can manage VAT rate data within their company.
     */
    match /companies/{companyId}/vatRates/{vatId} {
      function isSignedIn() {
        return request.auth != null;
      }
      allow get: if isSignedIn();
      allow list: if false;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Secure the /companies/{companyId}/heldOrders collection, allowing authenticated users to read/write held order data within their company.
     * @path /companies/{companyId}/heldOrders/{orderId}
     * @allow (get, list, create, update, delete) Any authenticated user can manage held orders within their company.
     * @deny (get, list, create, update, delete) Unauthenticated users cannot access held order data.
     * @principle Authenticated users can manage held order data within their company.
     */
    match /companies/{companyId}/heldOrders/{orderId} {
      function isSignedIn() {
        return request.auth != null;
      }
      allow get: if isSignedIn();
      allow list: if false;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }
  }
}